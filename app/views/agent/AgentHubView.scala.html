@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig
@import views.html.agent.partials._
@import views.html.helpers.PenaltiesBanner

@this(mainTemplate: MainTemplate,
      clientDetailsPartial: ClientDetailsPartial,
      registrationPartial: RegistrationPartial,
      signUpPartial: SignUpPartial,
      vatCertificatePartial: VatCertificatePartial,
      penaltiesTilePartial: PenaltiesTilePartial,
      govukBreadcrumbs: GovukBreadcrumbs,
      govukInsetText : GovukInsetText,
      govukNotificationBanner: GovukNotificationBanner,
      nextPaymentPartial: NextPaymentPartial,
      nextReturnPartial: NextReturnPartial,
      historyPartial: HistoryPartial,
      penaltiesBanner: PenaltiesBanner)

@(model: HubViewModel)(implicit messages: Messages, appConfig: AppConfig, user: User[_])

@notificationBannerContent = {
  <h3 id="noti-p1" class="govuk-heading-l govuk-notification-banner__heading">@messages("ddNotificationBanner.p1")</h3>
  <p id="noti-p2" class="govuk-body">@messages("ddNotificationBanner.p2")</p>
  <p id="noti-p3" class="govuk-body">@messages("ddNotificationBanner.p3")</p>
}

@tiles(hasPenaltiesTile: Boolean) = {
    @clientDetailsPartial()
    @vatCertificatePartial()
    @if(hasPenaltiesTile) {
        @penaltiesTilePartial()
    }
    @signUpPartial(model.details.mandationStatus, model.vrn)
    @registrationPartial(model.details, model.currentDate)
}

@blueBox = {
  @if(model.showBlueBox) {
    @govukNotificationBanner(NotificationBanner(
      title = Text(messages("ddNotificationBanner.title")),
      content = HtmlContent(notificationBannerContent),
      classes = "govuk-notification-banner__heading"
    ))
  }
}

@breadcrumbLinks = {
  @govukBreadcrumbs(Breadcrumbs(
    items = Seq(
      BreadcrumbsItem(
        content = Text(messages("breadcrumb.agentServices")),
        href = Some(appConfig.agentServicesUrl),
        attributes = Map("id" -> "agent-services-breadcrumb")
      )
    )
  ))
}

@mainTemplate(
  pageTitle = messages("agentHub.heading"),
  backLinkContent = Some(breadcrumbLinks),
  isTwoThirdsWidth = false,
  headerLink = false) {

  @blueBox

  <h1 class="govuk-heading-xl govuk-!-margin-bottom-0">@messages("agentHub.heading")</h1>
  <span class="govuk-caption-m">@messages("agentHub.vrn", model.vrn)</span>
  <span class="govuk-caption-m govuk-!-margin-bottom-0">@model.details.clientName</span>
  <span class="govuk-caption-m govuk-!-margin-bottom-6">
    <a id="change-client-link" href="@controllers.agent.routes.ConfirmClientVrnController.changeClient" class="govuk-link">
      @messages("agentHub.changeClient")
    </a>
  </span>

  @model.penaltiesSummary.map { summary =>
    @penaltiesBanner(summary)
  }

  <div class="flex-container govuk-grid-row">
    @nextPaymentPartial(model.details.isHybridUser, model.nextPaymentDate, model.payments, model.isOverdue, model.isError, model.directDebitSetup)
    @nextReturnPartial(model.details.optedIn)
    @historyPartial(model.details.isHybridUser)
  </div>

  <div>
    <h2 id="manage-vat-heading" class="govuk-heading-l">@messages("agentHub.manageVat")</h2>
  </div>

  @govukInsetText(InsetText(
    id = Some("noDDClient"),
    content = Text(messages("agentHub.noDDclient"))
  ))

  <div class="govuk-grid-row">
    @tiles(model.penaltiesSummary.fold(false)(_.hasAnyPenaltyData))
  </div>

}
